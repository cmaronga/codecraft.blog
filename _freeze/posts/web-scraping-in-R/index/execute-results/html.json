{
  "hash": "a93708df4850344f079945120a98d4e5",
  "result": {
    "markdown": "---\ntitle: \"Web scraping using R\"\n# author: \"Christopher Maronga\"\ndate: \"2023-10-31\"\ncategories: [Data mining, Data wrangling, tidyverse]\nimage: \"web-scraping.jpeg\"\n#draft: true\ndate-modified: \"2024-09-08\"\n---\n\n\nEfficient, flexible and powerful!\n\n# Introduction\n\nWeb scraping is concept that most probably you have heard about. This is the art of [harvesting](https://en.wikipedia.org/wiki/Web_scraping) publicly available data from a website for use in your analysis or reporting. Web scraping can be as simple as copying the contents of a website and pasting them on an excel sheet, but that’s not what we are going to do today. Most website pages are built using [HTML](https://en.wikipedia.org/wiki/HTML) and this allows us to use tools such as R to dynamically extract the data.\n\nIn this tutorial, I am going walk you through how you can harvest data from websites using R programming language. You can do this by coding the logic and instructions manually or use the package [`{rvest}`](https://rvest.tidyverse.org/) to easily extract the contents of a website. We would demonstrate the examples using the below two websites.\n\n- TheGlobalEconomy.com, [Exchange rate to USD by country](https://www.theglobaleconomy.com/rankings/Dollar_exchange_rate/)\n- [CRAN package](https://cran.r-project.org/web/packages/available_packages_by_date.html) website and [package download metrics](https://www.datasciencemeta.com/rpackages) website\n\n\nFirst, let's load the packages/tools of trade for the exercise.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# loading packages\npacman::p_load(\n  rvest,        # functions for webscraping\n  ggthemes,     # extend themes for ggplot2\n  lubridate,    # handle dates\n  here,         # manage file paths\n  flextable,    # quick tables\n  tidyverse     # data wranglinga and visualization\n)\n\n# set theme for ggplot2\ntheme_set(\n  theme_hc(base_size = 18) +                  # base size\n    theme(\n      legend.position = \"none\",              # No legend, unless specified in the plot\n      legend.title = element_blank(),         # No title on the legend\n      axis.title.y = element_text(angle = 90) # spin y title 90 degrees\n    )\n)\n```\n:::\n\n\n# using `rvest`\n\nThis is the simplest and easiest approach of then all. [rvest helps you scrape (or harvest)](https://rvest.tidyverse.org/) data from web pages and it's designed to work with the pipe chain style of coding.\n\nThree simples steps using this package:-\n\n- Use `read_tml` function to convert the the url into an `xml document`\n- pass the `xlm document` to the function `html_table` to convert it into a list contain table(s) from the url source site.\n- Now that you have tabular data, you can proceed with various data wrangling approaches to clean it up for use.\n\n## Dollar exchange data\n\nI came across this website [Exchange rate to USD by country](https://www.theglobaleconomy.com/rankings/Dollar_exchange_rate/) while I was working on aggregating output from an[ economic micro-simulation model](https://asbmr.onlinelibrary.wiley.com/doi/full/10.1002/jbmr.4775?af=R) estimating benefits and budget impact of setting up fracture liaison services. Part of my reporting costs associated with the FLS, reported in local currency for about 10 different countries, but for harmonized reporting and international consumption, I need to convert the local currencies to US Dollars, hence I needed a source that I could cite and is updated regularly.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get url from website\nexchange_rate_url <- \"https://www.theglobaleconomy.com/rankings/Dollar_exchange_rate/\"\n\n# read HTML from website\nexchange_rate_webpage <- read_html(exchange_rate_url)       # read html site\n\n\n# create a datframe containing the exchange rates for use\ncurrency_rates <- exchange_rate_webpage %>%\n  html_table() %>%                                          # output a list contain the exchange rate table from website\n  as.data.frame() %>%                                       # transform into a tibble\n  # rename columns appropriately\n  rename(\n    Country        = Countries,\n    DateLatestData     = \"Reference\",\n    LatesValue     = \"Latest.value\",\n    Change3months  = \"Change.three.months\",\n    Change12months = \"Change.twelve.months\"\n  ) %>%\n  mutate(across(LatesValue, as.numeric),                  # convert to numeric column containing exchange rate\n         \n         # On the date column; remove white space and replace \"/\" with \"-\"\n         DateLatestData = str_squish(\n           str_replace_all(\n             string = DateLatestData,\n             pattern = \"/\",\n             replacement = \"-\"\n           )\n         )) %>% \n  # transform `DateLatestData` into a proper date column\n  mutate(\n    DateLatestData = my(DateLatestData),                       # proper date format\n    DateLatestData = format(DateLatestData, \"%Y-%m\")           # YYYY-mm\n  )\n```\n:::\n\n\nThe first 15 rows of the harvested data are show below\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncurrency_rates %>% \n  head(15)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Country LatesValue DateLatestData Change3months Change12months\n1          Afghanistan    70.7133        2024-08        -0.61%        -17.45%\n2              Albania    90.7575        2024-08        -2.10%         -6.33%\n3              Algeria   134.2240        2024-08        -0.18%         -1.35%\n4              Andorra     0.9073        2024-08        -1.68%         -1.03%\n5               Angola   891.8101        2024-08         5.40%          7.95%\n6  Antigua and Barbuda     2.7026        2024-08         0.00%          0.00%\n7            Argentina   940.2254        2024-08         5.86%        195.41%\n8              Armenia   386.9613        2024-08         0.03%          0.33%\n9                Aruba     1.8006        2024-08        -0.04%         -0.03%\n10           Australia     1.5030        2024-08        -0.15%         -2.62%\n11             Austria     0.9073        2024-08        -1.68%         -1.03%\n12          Azerbaijan     1.7000        2024-08         0.00%          0.00%\n13             Bahamas     0.9986        2024-08        -0.07%         -0.09%\n14             Bahrain     0.3766        2024-08         0.00%         -0.03%\n15          Bangladesh   118.1472        2024-08         0.91%          8.15%\n```\n:::\n:::\n\n\n\nYou can now export the harvested data for later use downstream or in your modelling framework like I did. You see, easy and straight forward, right?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Export the data\n\nrio::export(currency_rates, here(\"datasets\", \"dollar_exchange_rates.rds\"))\n```\n:::\n\n\n\n## Available CRAN packages\n\nIn this section, we are going to harvest data from two websites:-\n\n- List of available [CRAN packages](https://cran.r-project.org/web/packages/available_packages_by_date.html) by data of publication\n- Tracked website of [CRAN packages by number of downloads](https://www.datasciencemeta.com/rpackages)\n- Additionally, to get some metrics to combine with data from the above 2 sites, we I use `available.packages` function for all cran packages in this [mirror](https://cran.r-project.org/)\n\n\n\n### CRAN packages by publication date\n\nI will use the 3 simple steps already covered earlier, employing `rvest` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Specifying the url\nurl <- 'https://cran.r-project.org/web/packages/available_packages_by_date.html'\n\n\n# create a dataframe using `rvest` functions\nr_pkgs_by_date <- read_html(url) %>% \n  html_table() %>% \n  as.data.frame() %>% \n  mutate(\n    Date = ymd(Date)\n  ) %>% \n  rename(pkg_name = Package, date_published = Date)\n\n# view top n rows\nr_pkgs_by_date %>% \n  head(10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   date_published    pkg_name\n1      2024-09-08    datefixR\n2      2024-09-08   EMCluster\n3      2024-09-08     ibdsim2\n4      2024-09-08      IsoriX\n5      2024-09-08      L1pack\n6      2024-09-08 matrixStats\n7      2024-09-08         msm\n8      2024-09-08   openxlsx2\n9      2024-09-08    pedtools\n10     2024-09-08   PMCMRplus\n                                                                              Title\n1                       Standardize Dates in Different Formats or with Missing Data\n2  EM Algorithm for Model-Based Clustering of Finite Mixture\\nGaussian Distribution\n3                        Simulation of Chromosomal Regions Shared by Family Members\n4         Isoscape Computation and Inference of Spatial Origins using\\nMixed Models\n5                                                        Routines for L1 Estimation\n6            Functions that Apply to Rows and Columns of Matrices (and to\\nVectors)\n7                    Multi-State Markov and Hidden Markov Models in Continuous Time\n8                                                 Read, Write and Edit 'xlsx' Files\n9                               Creating and Working with Pedigrees and Marker Data\n10              Calculate Pairwise Multiple Comparisons of Mean Rank Sums\\nExtended\n```\n:::\n:::\n\n\n### CRAN packages metadata\n\nIf I need additional details, I can use the function `available.packages()`; downside, it doesn't contain date of publication, but some other metrics which are equally important are returned by this function. So, I ma going to do that below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# using available.packages function\n\navailable_pks <- available.packages(#repos = \"http://cran.us.r-project.org\",\n                                                                            # specify CRAN mirror and metadata to extract\n  repos = \"https://cran.r-project.org/\")[, c(\"Version\",\n                                             \"Depends\",\n                                             \"Repository\",\n                                             \"NeedsCompilation\",\n                                             \"License\")] %>%\n  as.data.frame() %>% tibble::rownames_to_column(var = \"pkg_name\")\n\n# view top n rows\navailable_pks %>% \n  head(10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        pkg_name Version                                             Depends\n1             A3   1.0.0                      R (>= 2.15.0), xtable, pbapply\n2  AalenJohansen     1.0                                                <NA>\n3       AATtools   0.0.3                                        R (>= 3.6.0)\n4         ABACUS   1.0.0                                        R (>= 3.1.0)\n5    abasequence   0.1.0                                                <NA>\n6     abbreviate     0.1                                                <NA>\n7            abc   2.2.1 R (>= 2.10), abc.data, nnet, quantreg, MASS, locfit\n8       abc.data     1.1                                         R (>= 2.10)\n9        ABC.RAP   0.9.0                                        R (>= 3.1.0)\n10   ABCanalysis   1.2.1                                         R (>= 2.10)\n                               Repository NeedsCompilation    License\n1  https://cran.r-project.org/src/contrib               no GPL (>= 2)\n2  https://cran.r-project.org/src/contrib               no GPL (>= 2)\n3  https://cran.r-project.org/src/contrib               no      GPL-3\n4  https://cran.r-project.org/src/contrib               no      GPL-3\n5  https://cran.r-project.org/src/contrib               no      GPL-3\n6  https://cran.r-project.org/src/contrib               no      GPL-3\n7  https://cran.r-project.org/src/contrib               no GPL (>= 3)\n8  https://cran.r-project.org/src/contrib               no GPL (>= 3)\n9  https://cran.r-project.org/src/contrib               no      GPL-3\n10 https://cran.r-project.org/src/contrib               no      GPL-3\n```\n:::\n:::\n\n\n\n### CRAN packages downloads\n\nWe can grab metric on number of downloads for each package in CRAN from this [website.](https://www.datasciencemeta.com/rpackages)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npkg_down_url <- \"https://www.datasciencemeta.com/rpackages\"\n\npkg_downloads <- read_html(pkg_down_url) %>% \n  html_table() %>% \n  as.data.frame() %>% \n  select(-c(Author, Maintainer)) %>%                          # remove columns with no data\n  mutate(\n    Downloads = str_remove_all(Downloads, pattern = \",\"),     # get rid of commas\n    Downloads = as.integer(Downloads)                         # convert into an integer\n  ) %>% \n  rename(pkg_name = \"Package.Name\", downloads = Downloads)\n\n# view top n rows\npkg_downloads %>% \n  head(10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Rank pkg_name downloads\n1     1  ggplot2 147979440\n2     2    rlang 136425392\n3     3 magrittr 126139801\n4     4    dplyr 111533228\n5     5    vctrs  99097308\n6     6      cli  96527305\n7     7   tibble  93773928\n8     8 devtools  91913477\n9     9 jsonlite  91716968\n10   10     Rcpp  88506647\n```\n:::\n:::\n\n\n\nHere is the fun part, we can now join all the three datasets telling different aspects of the packages to have one dataframe we can use for visualization and expropriation, how cool is that🙂\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCRAN_pkgs <- reduce(\n  list(r_pkgs_by_date, pkg_downloads, available_pks), # reduce from purrr package\n  left_join,\n  by = \"pkg_name\"                                     # join by package_name\n) %>% arrange(Rank) %>% \n  select(Rank, pkg_name, downloads, everything())\n\n# view top n rows\n\nCRAN_pkgs %>% \n  head(5) %>% \n  reactable::reactable()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"reactable html-widget html-fill-item\" id=\"htmlwidget-ec37ef96a8d5d3a1d1e2\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ec37ef96a8d5d3a1d1e2\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"Rank\":[1,2,3,4,5],\"pkg_name\":[\"ggplot2\",\"rlang\",\"magrittr\",\"dplyr\",\"vctrs\"],\"downloads\":[147979440,136425392,126139801,111533228,99097308],\"date_published\":[\"2024-04-23\",\"2024-06-04\",\"2022-03-30\",\"2023-11-17\",\"2023-12-01\"],\"Title\":[\"Create Elegant Data Visualisations Using the Grammar of Graphics\",\"Functions for Base Types and Core R and 'Tidyverse' Features\",\"A Forward-Pipe Operator for R\",\"A Grammar of Data Manipulation\",\"Vector Helpers\"],\"Version\":[\"3.5.1\",\"1.1.4\",\"2.0.3\",\"1.1.4\",\"0.6.5\"],\"Depends\":[\"R (>= 3.5)\",\"R (>= 3.5.0)\",\"R (>= 3.4.0)\",\"R (>= 3.5.0)\",\"R (>= 3.5.0)\"],\"Repository\":[\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\"],\"NeedsCompilation\":[\"no\",\"yes\",\"yes\",\"yes\",\"yes\"],\"License\":[\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\"]},\"columns\":[{\"id\":\"Rank\",\"name\":\"Rank\",\"type\":\"numeric\"},{\"id\":\"pkg_name\",\"name\":\"pkg_name\",\"type\":\"character\"},{\"id\":\"downloads\",\"name\":\"downloads\",\"type\":\"numeric\"},{\"id\":\"date_published\",\"name\":\"date_published\",\"type\":\"Date\"},{\"id\":\"Title\",\"name\":\"Title\",\"type\":\"character\"},{\"id\":\"Version\",\"name\":\"Version\",\"type\":\"character\"},{\"id\":\"Depends\",\"name\":\"Depends\",\"type\":\"character\"},{\"id\":\"Repository\",\"name\":\"Repository\",\"type\":\"character\"},{\"id\":\"NeedsCompilation\",\"name\":\"NeedsCompilation\",\"type\":\"character\"},{\"id\":\"License\",\"name\":\"License\",\"type\":\"character\"}],\"dataKey\":\"b6ff7590134c28df1ca3d37750d7a415\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\nFor instance, as of the harvesting of this data, what are the top 20 most downloaded packages from CRAN. We can be able to summarize and visualize that information\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCRAN_pkgs %>% \n  filter(Rank <= 20) %>% \n  reactable::reactable()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"reactable html-widget html-fill-item\" id=\"htmlwidget-795b84d16063f511336c\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-795b84d16063f511336c\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"Rank\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],\"pkg_name\":[\"ggplot2\",\"rlang\",\"magrittr\",\"dplyr\",\"vctrs\",\"cli\",\"tibble\",\"devtools\",\"jsonlite\",\"Rcpp\",\"pillar\",\"lifecycle\",\"glue\",\"ragg\",\"textshaping\",\"stringr\",\"stringi\",\"tidyverse\",\"digest\",\"sf\"],\"downloads\":[147979440,136425392,126139801,111533228,99097308,96527305,93773928,91913477,91716968,88506647,87840928,86647531,85566368,85144381,83348776,78990749,75289924,73021885,71572781,68318677],\"date_published\":[\"2024-04-23\",\"2024-06-04\",\"2022-03-30\",\"2023-11-17\",\"2023-12-01\",\"2024-06-21\",\"2023-03-20\",\"2022-10-11\",\"2023-12-04\",\"2024-07-17\",\"2023-03-22\",\"2023-11-07\",\"2024-01-09\",\"2024-05-15\",\"2024-05-24\",\"2023-11-14\",\"2024-05-06\",\"2023-02-22\",\"2024-08-19\",\"2024-09-06\"],\"Title\":[\"Create Elegant Data Visualisations Using the Grammar of Graphics\",\"Functions for Base Types and Core R and 'Tidyverse' Features\",\"A Forward-Pipe Operator for R\",\"A Grammar of Data Manipulation\",\"Vector Helpers\",\"Helpers for Developing Command Line Interfaces\",\"Simple Data Frames\",\"Tools to Make Developing R Packages Easier\",\"A Simple and Robust JSON Parser and Generator for R\",\"Seamless R and C++ Integration\",\"Coloured Formatting for Columns\",\"Manage the Life Cycle of your Package Functions\",\"Interpreted String Literals\",\"Graphic Devices Based on AGG\",\"Bindings to the 'HarfBuzz' and 'Fribidi' Libraries for Text\\nShaping\",\"Simple, Consistent Wrappers for Common String Operations\",\"Fast and Portable Character String Processing Facilities\",\"Easily Install and Load the 'Tidyverse'\",\"Create Compact Hash Digests of R Objects\",\"Simple Features for R\"],\"Version\":[\"3.5.1\",\"1.1.4\",\"2.0.3\",\"1.1.4\",\"0.6.5\",\"3.6.3\",\"3.2.1\",\"2.4.5\",\"1.8.8\",\"1.0.13\",\"1.9.0\",\"1.0.4\",\"1.7.0\",\"1.3.2\",\"0.4.0\",\"1.5.1\",\"1.8.4\",\"2.0.0\",\"0.6.37\",\"1.0-17\"],\"Depends\":[\"R (>= 3.5)\",\"R (>= 3.5.0)\",\"R (>= 3.4.0)\",\"R (>= 3.5.0)\",\"R (>= 3.5.0)\",\"R (>= 3.4)\",\"R (>= 3.4.0)\",\"R (>= 3.0.2), usethis (>= 2.1.6)\",\"methods\",null,null,\"R (>= 3.6)\",\"R (>= 3.6)\",null,\"R (>= 3.2.0)\",\"R (>= 3.6)\",\"R (>= 3.4)\",\"R (>= 3.3)\",\"R (>= 3.3.0)\",\"methods, R (>= 3.3.0)\"],\"Repository\":[\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\",\"https://cran.r-project.org/src/contrib\"],\"NeedsCompilation\":[\"no\",\"yes\",\"yes\",\"yes\",\"yes\",\"yes\",\"yes\",\"no\",\"yes\",\"yes\",\"no\",\"no\",\"yes\",\"yes\",\"yes\",\"no\",\"yes\",\"no\",\"yes\",\"yes\"],\"License\":[\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"GPL (>= 2)\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"MIT + file LICENSE\",\"file LICENSE\",\"MIT + file LICENSE\",\"GPL (>= 2)\",\"GPL-2 | MIT + file LICENSE\"]},\"columns\":[{\"id\":\"Rank\",\"name\":\"Rank\",\"type\":\"numeric\"},{\"id\":\"pkg_name\",\"name\":\"pkg_name\",\"type\":\"character\"},{\"id\":\"downloads\",\"name\":\"downloads\",\"type\":\"numeric\"},{\"id\":\"date_published\",\"name\":\"date_published\",\"type\":\"Date\"},{\"id\":\"Title\",\"name\":\"Title\",\"type\":\"character\"},{\"id\":\"Version\",\"name\":\"Version\",\"type\":\"character\"},{\"id\":\"Depends\",\"name\":\"Depends\",\"type\":\"character\"},{\"id\":\"Repository\",\"name\":\"Repository\",\"type\":\"character\"},{\"id\":\"NeedsCompilation\",\"name\":\"NeedsCompilation\",\"type\":\"character\"},{\"id\":\"License\",\"name\":\"License\",\"type\":\"character\"}],\"dataKey\":\"525e4fe01f0d1181692f3cc3b2bababa\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\nMore fun exploration and data wrangling can be performed on the harvested data, feel free to play with the data further.\n\n\nExport the combined dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# export data for playing around with\n\nrio::export(CRAN_pkgs, here(\"datasets\", \"CRAN_pkgs.rds\"))\n```\n:::\n\n\n\n\n# Manually using `readLines()`\n\nSometimes, not all websites are structured in the manner that the dollar exchange website is. What this means is that the magic of the two functions above (`read_html` and `html_tabel`) do not work as expected.\n\nIn such scenarios, I am going to show you a manual way to still harvest data using the `readLines` functions. I must admit that this is a very painful approach and is NOT standard nor reproducible as it depends on the state/structure of the website at the time of harvesting.\n\n\n\n#### **Read the webpage**\n\nThe first step is to read the html code from the website using `readLines` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# store url link\ndollar_ex_url <- \"https://www.theglobaleconomy.com/rankings/Dollar_exchange_rate/\"\n\n# Reading the HTML code from the website\ndollaEx_webpage <- readLines(dollar_ex_url)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in readLines(dollar_ex_url): incomplete final line found on\n'https://www.theglobaleconomy.com/rankings/Dollar_exchange_rate/'\n```\n:::\n\n```{.r .cell-code}\nhead(dollaEx_webpage, 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"<!DOCTYPE html>\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \n [2] \"<html xmlns='https://www.w3.org/1999/xhtml' lang=\\\"en\\\" xml:lang='en' >\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \n [3] \"\\t<head>\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \n [4] \"\\t\\t<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0\\\"/>\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \n [5] \"\\t\\t\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \n [6] \"\\t\\t<link rel=\\\"canonical\\\" href=\\\"https://www.theglobaleconomy.com/rankings/Dollar_exchange_rate/\\\">\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \n [7] \"\\t\\t\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \n [8] \"\\t\\t\\t\\t<meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=utf-8\\\" />\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \n [9] \"\\t\\t\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \n[10] \"\\t\\t<link rel=\\\"shortcut icon\\\" href=\\\"/favicon.ico\\\" type=\\\"image/x-icon\\\">\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \n[11] \"\\t\\t<link rel=\\\"icon\\\" href=\\\"/favicon.ico\\\" type=\\\"image/x-icon\\\">\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \n[12] \"\\t\\t\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \n[13] \"\\t\\t<title>USD exchange rate around the world | TheGlobalEconomy.com</title>\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \n[14] \"\\t\\t<meta name=\\\"Keywords\\\" content=\\\"USD exchange rate around the world\\\" />\"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      \n[15] \"\\t\\t<meta name=\\\"Description\\\" content=\\\"What factors determine the exchange rates The exchange rate is the price of one currency expressed in units of another currency. We say that a currency is appreciating/depreciating relative to another currency if it takes more/less units of the other currency to purchase it. The exchange rate appreciates when the demand for the currency increases, i.e. when more people want to buy it and depreciates when the supply increases, i.e. when more people want to sell it. Look at it from the U.S. perspective. Foreigners want to buy dollars when they: 1.\\tInvest in the U.S. 2.\\tBuy goods and services from the U.S. At the same time U.S. citizens sell dollars when they: 1.\\tInvest overseas. 2.\\tBuy foreign goods and services. Holding all else constant, if foreign investment in the U.S. increases, this will create more demand for dollars, and the dollar will appreciate. Similarly, when the U.S. increases its international purchases and investments, that creates additional supply of dollars and the dollar will depreciate. Several examples U.S. interest rates increase. That leads to greater foreign investment into the U.S., greater demand for dollars, and dollar appreciation. New tariffs on U.S. exports to Europe. Now foreigners buy fewer U.S. goods, the demand for dollars declines, and the dollar depreciates. The U.S. economy is growing rapidly. On one hand, that attracts foreign investment and causes dollar appreciation. On the other hand, U.S. imports increase since Americans can buy more international goods and services and cause dollar depreciation. We are not sure which effect would be stronger but usually a growing economy is associated with an appreciating currency. Expected appreciation of the dollar. If for some reason investors believe that the dollar will appreciate in one year, they will want to buy it now. This creates additional demand for dollars and leads to appreciation now. If you wonder what the effect of some macroeconomic variable on the exchange rate is, ask yourself how, holding everything else constant, that variable affects the demand or the supply of the currency. Based on that, you can determine if the change is likely to lead to appreciation or depreciation. Forecasting currency values: short, medium, and long run Of course, in reality there are multiple macroeconomic changes occurring at the same time. Interest rates may be changing in various countries, GDP growth rates differ, trade flows shift, etc. The combination of all these factors makes it virtually impossible to predict the exchange rate at short horizons (days, weeks). Too many fundamentals are moving in different directions at the same time. Therefore, economists say that the exchange rate follows a “random walk”, i.e. the best forecast of tomorrow’s exchange rate is today’s exchange rate. The likelihood of appreciation and depreciation are the same. At medium-term time horizons (months, a few years) the effect of particular macroeconomic fundamentals on the exchange rate becomes more visible. For example, if the economy is growing rapidly its currency is likely to appreciate as the country attracts international capital that creates demand for the local money. In contrast, in the long-run (many years, decades) macroeconomic fundamentals cease to have a role. Over such long periods of time, the economic growth rates, interest rates, as well as international trade and investment flows have stabilized at some “average” levels. Then, the only determinant of the exchange rate is the rate of money supply growth. Countries that print money more rapidly than the rest of the world will experience currency depreciation. In fact, the size of the depreciation would be equal to the increase of the money supply. Recall that the exchange rate is the price of a currency. If you create too much of it the price will come down. Additional resources Information about the European Monetary Union with a lot of historic information, analyses and data. Available from: European Central Bank The International Monetary Fund, a wealth of information about all member countries and about international financial markets. Available from: IMF.\\\" />\"\n```\n:::\n:::\n\n\nThe `dollaEx_webpage` is basically a HTML page with all the usual html tags and stuff. So, we are going refer to the website for a start point to give us reference for first entry and last entry of the page. From experience, I have found focusing on the actual data saves time and very easy to proceed forth as opposed to randomly picking any entry on the page.\n\nFor instance, Afghanistan is the first entry on the table and Zambia is the last entry, this gives me an idea of the bound of the data that I want. Ideally I need everything between entry one and last entry and I am going to show you how.\n\n\n#### **Search for data bounds**\n\nNow, the manual work starts here. From the source website, I want to find the index or indices of `Afghanistan`, my first data point.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr_which(dollaEx_webpage, \"Afghanistan\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 949\n```\n:::\n:::\n\n\nWhat this means is that the key word Afghanistan has been found in position 922 (sometimes multiple positions get returned). We can try to triangulate around these positions and see what we’ve got going. There is not rule for triangulation, you just throw the net and inspect the output, that’s why it’s a manual approach.\n\nFrom the `dollaEx_webpage` object and with the index of my first data point, I start the triangulation process. For instance, let me view the next 10 lines after position `922`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndollaEx_webpage[922:932] # first 10 lines\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"\\t\\t\\tSelect indicator\\t\\t</a>\"                                                                                                                                                                                                    \n [2] \"\\t\\t<div style=\\\"font-size: 0.8em;text-align: center;\\\">* indicates monthly or quarterly data series</div>\"                                                                                                                        \n [3] \"\\t</div>\"                                                                                                                                                                                                                          \n [4] \"\"                                                                                                                                                                                                                                  \n [5] \"\\t<div style=\\\"float: left; width: 35px; height: 20px;\\\" class=\\\"more850px\\\"></div>\"                                                                                                                                               \n [6] \"\\t\"                                                                                                                                                                                                                                \n [7] \"\\t<div style=\\\"width: 98%; max-width: 750px; text-align: justify; float:left; vertical-align:top; margin: 10px 0 0 5px\\\">\"                                                                                                         \n [8] \"\\t\\t<div style=\\\"width: 100%; overflow: auto;\\\">\"                                                                                                                                                                                  \n [9] \"\\t\\t\\tThe amount of local currency units that can be exchanged for one USD. An increase (decrease) means USD appreciation (depreciation). The values are monthly averages of the daily exchange rates provided by Google Finance. \"\n[10] \"\\t\\t\\t</br></br>\"                                                                                                                                                                                                                  \n[11] \"\\t\\t\\t<div style=\\\"width: auto; max-width: 300px; float: left; margin: 0 0 0 0px\\\">\"                                                                                                                                               \n```\n:::\n:::\n\n\nClearly from the above output, if I were interested in data for `Afghanistan` only, i.e. the 5 columns from the table in the website, they are contained between positions 922 and 926, see below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndollaEx_webpage[922:926] \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"\\t\\t\\tSelect indicator\\t\\t</a>\"                                                                            \n[2] \"\\t\\t<div style=\\\"font-size: 0.8em;text-align: center;\\\">* indicates monthly or quarterly data series</div>\"\n[3] \"\\t</div>\"                                                                                                  \n[4] \"\"                                                                                                          \n[5] \"\\t<div style=\\\"float: left; width: 35px; height: 20px;\\\" class=\\\"more850px\\\"></div>\"                       \n```\n:::\n:::\n\n\n**NOTE**, I am ONLY interested at the start and end of the data string containing the columns a.ka. data that I need. Do the same for the last entry on the table (in the website), which in this case is `Zambia.` \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Last entry\nstr_which(dollaEx_webpage, \"Zambia\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2279\n```\n:::\n:::\n\n\nNOTE, I am interested at the start and end of the data string. The index for Zambia is 2252, based on what I did with the first entry on the table, it simply means that the data bound for Zambia is contained within 4 steps/lines from 2252. See below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndollaEx_webpage[2252:2256]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"\\t\\t\\t\\t\\t\\t<td>12631.2350</td>\"        \n[2] \"\\t\\t\\t\\t\\t\\t<td>Aug / 2024</td>\"        \n[3] \"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<td>-0.51%</td>\"\n[4] \"\\t\\t\\t\\t\\t\\t<td>5.74%</td>\"             \n[5] \"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t</tr>\"            \n```\n:::\n:::\n\n\nAfter carefully inspecting the above outputs, I can conclude that the data I am looking for (the whole table) lies between 922 to 2256. Anything before or after contain nothing other than \"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\" tags only.\n\n\n#### **Define whole data bounds**\n\nAfter arriving at this conclusion, then next step is to now narrow your webpage to the data bounds only i.e.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# resize your webpage to only contain the data\ndollaEx_webData <- dollaEx_webpage[922:2256]\n\nhead(dollaEx_webData, 15)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"\\t\\t\\tSelect indicator\\t\\t</a>\"                                                                                                                                                                                                    \n [2] \"\\t\\t<div style=\\\"font-size: 0.8em;text-align: center;\\\">* indicates monthly or quarterly data series</div>\"                                                                                                                        \n [3] \"\\t</div>\"                                                                                                                                                                                                                          \n [4] \"\"                                                                                                                                                                                                                                  \n [5] \"\\t<div style=\\\"float: left; width: 35px; height: 20px;\\\" class=\\\"more850px\\\"></div>\"                                                                                                                                               \n [6] \"\\t\"                                                                                                                                                                                                                                \n [7] \"\\t<div style=\\\"width: 98%; max-width: 750px; text-align: justify; float:left; vertical-align:top; margin: 10px 0 0 5px\\\">\"                                                                                                         \n [8] \"\\t\\t<div style=\\\"width: 100%; overflow: auto;\\\">\"                                                                                                                                                                                  \n [9] \"\\t\\t\\tThe amount of local currency units that can be exchanged for one USD. An increase (decrease) means USD appreciation (depreciation). The values are monthly averages of the daily exchange rates provided by Google Finance. \"\n[10] \"\\t\\t\\t</br></br>\"                                                                                                                                                                                                                  \n[11] \"\\t\\t\\t<div style=\\\"width: auto; max-width: 300px; float: left; margin: 0 0 0 0px\\\">\"                                                                                                                                               \n[12] \"\\t\\t\\t\\t<a href=\\\"https://www.theglobaleconomy.com/download-data.php\\\" target=\\\"_blank\\\" style=\\\"font-weight: bold;\\\">Download data from our database</a>\"                                                                         \n[13] \"<!-- \\t\\t\\t<a href=\\\"https://www.theglobaleconomy.com/data_feed_api.php\\\" target=\\\"_blank\\\" style=\\\"color: #e2bb04; display: inline-block; margin: 0 0 0 20px;\\\">API</a>-->\"                                                       \n[14] \"\\t\\t\\t</div>\"                                                                                                                                                                                                                      \n[15] \"\\t\\t\\t</br></br>\"                                                                                                                                                                                                                  \n```\n:::\n:::\n\n\nIf you widely look at the object `dollaEx_webData`, it contains a lot of unnecessary \"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\" tags, so now it’s time to clean this object carefully ind order to obtain the data.\n\n\n#### **Cleanup process**\n\nFirst get rid of all the `\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\"`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# remove ALL the \"\\t\"\ndollaEx_clean <- dollaEx_webData %>% str_remove_all(pattern = \"\\t\")\n\nhead(dollaEx_clean,25)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Select indicator</a>\"                                                                                                                                                                                                        \n [2] \"<div style=\\\"font-size: 0.8em;text-align: center;\\\">* indicates monthly or quarterly data series</div>\"                                                                                                                      \n [3] \"</div>\"                                                                                                                                                                                                                      \n [4] \"\"                                                                                                                                                                                                                            \n [5] \"<div style=\\\"float: left; width: 35px; height: 20px;\\\" class=\\\"more850px\\\"></div>\"                                                                                                                                           \n [6] \"\"                                                                                                                                                                                                                            \n [7] \"<div style=\\\"width: 98%; max-width: 750px; text-align: justify; float:left; vertical-align:top; margin: 10px 0 0 5px\\\">\"                                                                                                     \n [8] \"<div style=\\\"width: 100%; overflow: auto;\\\">\"                                                                                                                                                                                \n [9] \"The amount of local currency units that can be exchanged for one USD. An increase (decrease) means USD appreciation (depreciation). The values are monthly averages of the daily exchange rates provided by Google Finance. \"\n[10] \"</br></br>\"                                                                                                                                                                                                                  \n[11] \"<div style=\\\"width: auto; max-width: 300px; float: left; margin: 0 0 0 0px\\\">\"                                                                                                                                               \n[12] \"<a href=\\\"https://www.theglobaleconomy.com/download-data.php\\\" target=\\\"_blank\\\" style=\\\"font-weight: bold;\\\">Download data from our database</a>\"                                                                           \n[13] \"<!-- <a href=\\\"https://www.theglobaleconomy.com/data_feed_api.php\\\" target=\\\"_blank\\\" style=\\\"color: #e2bb04; display: inline-block; margin: 0 0 0 20px;\\\">API</a>-->\"                                                       \n[14] \"</div>\"                                                                                                                                                                                                                      \n[15] \"</br></br>\"                                                                                                                                                                                                                  \n[16] \"<table id=\\\"benchmarkTable\\\" class=\\\"sortable\\\" style=\\\"width: 100%; max-width: 750px;\\\">\"                                                                                                                                   \n[17] \"<thead>\"                                                                                                                                                                                                                     \n[18] \"<tr style=\\\"height: 40px;\\\">\"                                                                                                                                                                                                \n[19] \"<th>Countries</th>\"                                                                                                                                                                                                          \n[20] \"<th>Latest value</th>\"                                                                                                                                                                                                       \n[21] \"<th>Reference</th>\"                                                                                                                                                                                                          \n[22] \"<th>Change three months</th>\"                                                                                                                                                                                                \n[23] \"<th>Change twelve months</th>\"                                                                                                                                                                                               \n[24] \"</tr>\"                                                                                                                                                                                                                       \n[25] \"</thead>\"                                                                                                                                                                                                                    \n```\n:::\n:::\n\n\nThe object `dollaEx_webData` basically contains unique strings that contain data from the column of the table in the `url.` If you look closely, you will see a recurring pattern of strings, each starting with `\"\"<td><a href='/\" `and ending with a double `\"</tr>\"`; and ideally, this is the trick. The ability to understand the output and content of `dollaEx_clean.`\n\nIf you then count these start and end of recurring patterns, you find that they are 7 in number, so a single country data is composed of 7 unique strings Try viewing the first 25 rows of `dollaEx_clean`, you will be able to see what I mean.\n\nTake these unique strings and turn them into a matrix with each column containing the vital pieces of information and drop what is NOT required.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndollaEx_matrix <- matrix(dollaEx_clean, \n                         ncol = 7, # 7 columns because there were 7 unique strings\n                         byrow = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in matrix(dollaEx_clean, ncol = 7, byrow = TRUE): data length [1335] is\nnot a sub-multiple or multiple of the number of rows [191]\n```\n:::\n\n```{.r .cell-code}\nhead(dollaEx_matrix, 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     [,1]                                          \n[1,] \"Select indicator</a>\"                        \n[2,] \"<div style=\\\"width: 100%; overflow: auto;\\\">\"\n[3,] \"</br></br>\"                                  \n[4,] \"<th>Change three months</th>\"                \n     [,2]                                                                                                                                                                                                                          \n[1,] \"<div style=\\\"font-size: 0.8em;text-align: center;\\\">* indicates monthly or quarterly data series</div>\"                                                                                                                      \n[2,] \"The amount of local currency units that can be exchanged for one USD. An increase (decrease) means USD appreciation (depreciation). The values are monthly averages of the daily exchange rates provided by Google Finance. \"\n[3,] \"<table id=\\\"benchmarkTable\\\" class=\\\"sortable\\\" style=\\\"width: 100%; max-width: 750px;\\\">\"                                                                                                                                   \n[4,] \"<th>Change twelve months</th>\"                                                                                                                                                                                               \n     [,3]        \n[1,] \"</div>\"    \n[2,] \"</br></br>\"\n[3,] \"<thead>\"   \n[4,] \"</tr>\"     \n     [,4]                                                                           \n[1,] \"\"                                                                             \n[2,] \"<div style=\\\"width: auto; max-width: 300px; float: left; margin: 0 0 0 0px\\\">\"\n[3,] \"<tr style=\\\"height: 40px;\\\">\"                                                 \n[4,] \"</thead>\"                                                                     \n     [,5]                                                                                                                                               \n[1,] \"<div style=\\\"float: left; width: 35px; height: 20px;\\\" class=\\\"more850px\\\"></div>\"                                                                \n[2,] \"<a href=\\\"https://www.theglobaleconomy.com/download-data.php\\\" target=\\\"_blank\\\" style=\\\"font-weight: bold;\\\">Download data from our database</a>\"\n[3,] \"<th>Countries</th>\"                                                                                                                               \n[4,] \"<tbody>\"                                                                                                                                          \n     [,6]                                                                                                                                                                   \n[1,] \"\"                                                                                                                                                                     \n[2,] \"<!-- <a href=\\\"https://www.theglobaleconomy.com/data_feed_api.php\\\" target=\\\"_blank\\\" style=\\\"color: #e2bb04; display: inline-block; margin: 0 0 0 20px;\\\">API</a>-->\"\n[3,] \"<th>Latest value</th>\"                                                                                                                                                \n[4,] \"<tr>\"                                                                                                                                                                 \n     [,7]                                                                                                                     \n[1,] \"<div style=\\\"width: 98%; max-width: 750px; text-align: justify; float:left; vertical-align:top; margin: 10px 0 0 5px\\\">\"\n[2,] \"</div>\"                                                                                                                 \n[3,] \"<th>Reference</th>\"                                                                                                     \n[4,] \"<td><a href='/Afghanistan/Dollar_exchange_rate/' style=\\\"color:#000;\\\">Afghanistan</a></td>\"                            \n```\n:::\n:::\n\n\nThe matrix contains 7 columns (7 uniques strings, remember?). Information that we are most interested in (i.e the columns of the table in the url) are contained in the following columns of the matrix.\n\n  - column 1 contains country\n  - column 3 contains latest data from\n  - column 2 contains latest value\n  - column 4 contains change 3 months\n  - column 5 contains change 12 months\n\nWith this information, we can now construct the final clean matrix by droping column 6 and 7 which contains nothing we are interested in.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# drop columns that don't contain information of interest\ndollaEx_matrix_clean <- dollaEx_matrix[, c(1, 2, 3, 4, 5)]\n\nhead(dollaEx_matrix_clean, 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     [,1]                                          \n[1,] \"Select indicator</a>\"                        \n[2,] \"<div style=\\\"width: 100%; overflow: auto;\\\">\"\n[3,] \"</br></br>\"                                  \n[4,] \"<th>Change three months</th>\"                \n[5,] \"<td>70.7133</td>\"                            \n     [,2]                                                                                                                                                                                                                          \n[1,] \"<div style=\\\"font-size: 0.8em;text-align: center;\\\">* indicates monthly or quarterly data series</div>\"                                                                                                                      \n[2,] \"The amount of local currency units that can be exchanged for one USD. An increase (decrease) means USD appreciation (depreciation). The values are monthly averages of the daily exchange rates provided by Google Finance. \"\n[3,] \"<table id=\\\"benchmarkTable\\\" class=\\\"sortable\\\" style=\\\"width: 100%; max-width: 750px;\\\">\"                                                                                                                                   \n[4,] \"<th>Change twelve months</th>\"                                                                                                                                                                                               \n[5,] \"<td>Aug / 2024</td>\"                                                                                                                                                                                                         \n     [,3]             \n[1,] \"</div>\"         \n[2,] \"</br></br>\"     \n[3,] \"<thead>\"        \n[4,] \"</tr>\"          \n[5,] \"<td>-0.61%</td>\"\n     [,4]                                                                           \n[1,] \"\"                                                                             \n[2,] \"<div style=\\\"width: auto; max-width: 300px; float: left; margin: 0 0 0 0px\\\">\"\n[3,] \"<tr style=\\\"height: 40px;\\\">\"                                                 \n[4,] \"</thead>\"                                                                     \n[5,] \"<td>-17.45%</td>\"                                                             \n     [,5]                                                                                                                                               \n[1,] \"<div style=\\\"float: left; width: 35px; height: 20px;\\\" class=\\\"more850px\\\"></div>\"                                                                \n[2,] \"<a href=\\\"https://www.theglobaleconomy.com/download-data.php\\\" target=\\\"_blank\\\" style=\\\"font-weight: bold;\\\">Download data from our database</a>\"\n[3,] \"<th>Countries</th>\"                                                                                                                               \n[4,] \"<tbody>\"                                                                                                                                          \n[5,] \"</tr>\"                                                                                                                                            \n```\n:::\n:::\n\n\n\nNow construct a tibble from the above matrix and this will be our final product of the table from the url\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# final table\nexchange_data <- tibble(\n      Country = dollaEx_matrix_clean[, 1],\n      LatestData = dollaEx_matrix_clean[, 3],\n      LatesValue = dollaEx_matrix_clean[, 2],\n      Change3months = dollaEx_matrix_clean[ ,4],\n      Change12months = dollaEx_matrix_clean[ ,5]\n    )\n\nhead(exchange_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  Country                     LatestData LatesValue Change3months Change12months\n  <chr>                       <chr>      <chr>      <chr>         <chr>         \n1 \"Select indicator</a>\"      </div>     \"<div sty… \"\"            \"<div style=\\…\n2 \"<div style=\\\"width: 100%;… </br></br> \"The amou… \"<div style=… \"<a href=\\\"ht…\n3 \"</br></br>\"                <thead>    \"<table i… \"<tr style=\\… \"<th>Countrie…\n4 \"<th>Change three months</… </tr>      \"<th>Chan… \"</thead>\"    \"<tbody>\"     \n5 \"<td>70.7133</td>\"          <td>-0.61… \"<td>Aug … \"<td>-17.45%… \"</tr>\"       \n6 \"<td>90.7575</td>\"          <td>-2.10… \"<td>Aug … \"<td>-6.33%<… \"</tr>\"       \n```\n:::\n:::\n\n\n\nFurther clean up process for the columns (They don't contain usable date yet), so many html tags that needs to be removed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexchange_data <- exchange_data %>% \n  mutate(\n    Country = str_remove(Country, pattern = \"/Dollar_exchange_rate/.*\"), # remove all characters after \"/Dollar_exchange_rate/\"\n    Country = str_remove(Country, pattern = \"<td><a href='/\")            # remove the start tag for each value of country\n  )\n\nhead(exchange_data, 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 5\n  Country                     LatestData LatesValue Change3months Change12months\n  <chr>                       <chr>      <chr>      <chr>         <chr>         \n1 \"Select indicator</a>\"      </div>     \"<div sty… \"\"            \"<div style=\\…\n2 \"<div style=\\\"width: 100%;… </br></br> \"The amou… \"<div style=… \"<a href=\\\"ht…\n3 \"</br></br>\"                <thead>    \"<table i… \"<tr style=\\… \"<th>Countrie…\n4 \"<th>Change three months</… </tr>      \"<th>Chan… \"</thead>\"    \"<tbody>\"     \n5 \"<td>70.7133</td>\"          <td>-0.61… \"<td>Aug … \"<td>-17.45%… \"</tr>\"       \n```\n:::\n:::\n\n\n\nThe rest contain almost similar pattern, we are going to clean all them at a go. Basically remove the patterns/tags `<td>` and `</td>` from our columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexchange_data <- exchange_data %>% \n  mutate(across(.cols = c(LatestData:Change12months),\n                .fns = ~ str_remove_all(., pattern = \"<td>|</td>\")    # remove the patterns \"<td>|</td>\"\n                  )) %>%\n  mutate(across(LatesValue, as.numeric),                              # convert to numeric column containing exchange rate\n         \n         # On the date column; remove white space and replace \"/\" with \"-\"\n         LatestData = str_squish(\n           str_replace_all(\n             string = LatestData,\n             pattern = \"/\",\n             replacement = \"-\"\n           )\n         )) %>% \n  # transform `LatestData` into a proper date column\n  mutate(\n    LatestData = my(LatestData),                       # proper date format\n    LatestData = format(LatestData, \"%Y-%m\")           # YYYY-mm\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `across(LatesValue, as.numeric)`.\nCaused by warning:\n! NAs introduced by coercion\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `LatestData = my(LatestData)`.\nCaused by warning:\n!  191 failed to parse.\n```\n:::\n\n```{.r .cell-code}\nexchange_data %>% \n  tail(6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  Country             LatestData LatesValue Change3months Change12months\n  <chr>               <chr>           <dbl> <chr>         <chr>         \n1 <td>3717.0528</td>  <NA>               NA 0.74%         </tr>         \n2 <td>41.1613</td>    <NA>               NA 11.54%        </tr>         \n3 <td>3.6730</td>     <NA>               NA 0.00%         </tr>         \n4 <td>0.7726</td>     <NA>               NA -1.88%        </tr>         \n5 <td>40.3301</td>    <NA>               NA 6.49%         </tr>         \n6 <td>12631.2350</td> <NA>               NA 5.74%         </tr>         \n```\n:::\n:::\n\n\n\n**NOTE**: The downside of this manual approach is that it always depends on the website not changing structure, for instance if we had other countries added after Zambia, then our code above would not be able to extract that extra data sadly.\n\n\n# Session info\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.3.2 (2023-10-31)\n os       macOS Sonoma 14.6.1\n system   aarch64, darwin20\n ui       X11\n language (EN)\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       Europe/London\n date     2024-09-08\n pandoc   3.1.11 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package           * version date (UTC) lib source\n askpass             1.2.0   2023-09-03 [1] CRAN (R 4.3.0)\n cli                 3.6.3   2024-06-21 [1] CRAN (R 4.3.3)\n colorspace          2.1-1   2024-07-26 [1] CRAN (R 4.3.3)\n crayon              1.5.3   2024-06-20 [1] CRAN (R 4.3.3)\n crosstalk           1.2.1   2023-11-23 [1] CRAN (R 4.3.1)\n crul                1.5.0   2024-07-19 [1] CRAN (R 4.3.3)\n curl                5.2.1   2024-03-01 [1] CRAN (R 4.3.1)\n data.table          1.15.4  2024-03-30 [1] CRAN (R 4.3.1)\n digest              0.6.37  2024-08-19 [1] CRAN (R 4.3.3)\n dplyr             * 1.1.4   2023-11-17 [1] CRAN (R 4.3.1)\n evaluate            0.24.0  2024-06-10 [1] CRAN (R 4.3.3)\n fansi               1.0.6   2023-12-08 [1] CRAN (R 4.3.1)\n fastmap             1.2.0   2024-05-15 [1] CRAN (R 4.3.3)\n flextable         * 0.9.6   2024-05-05 [1] CRAN (R 4.3.1)\n fontBitstreamVera   0.1.1   2017-02-01 [1] CRAN (R 4.3.0)\n fontLiberation      0.1.0   2016-10-15 [1] CRAN (R 4.3.0)\n fontquiver          0.2.1   2017-02-01 [1] CRAN (R 4.3.0)\n forcats           * 1.0.0   2023-01-29 [1] CRAN (R 4.3.0)\n gdtools             0.3.7   2024-03-05 [1] CRAN (R 4.3.1)\n generics            0.1.3   2022-07-05 [1] CRAN (R 4.3.0)\n gfonts              0.2.0   2023-01-08 [1] CRAN (R 4.3.0)\n ggplot2           * 3.5.1   2024-04-23 [1] CRAN (R 4.3.1)\n ggthemes          * 5.1.0   2024-02-10 [1] CRAN (R 4.3.1)\n glue                1.7.0   2024-01-09 [1] CRAN (R 4.3.1)\n gtable              0.3.5   2024-04-22 [1] CRAN (R 4.3.1)\n here              * 1.0.1   2020-12-13 [1] CRAN (R 4.3.0)\n hms                 1.1.3   2023-03-21 [1] CRAN (R 4.3.0)\n htmltools           0.5.8.1 2024-04-04 [1] CRAN (R 4.3.1)\n htmlwidgets         1.6.4   2023-12-06 [1] CRAN (R 4.3.1)\n httpcode            0.3.0   2020-04-10 [1] CRAN (R 4.3.0)\n httpuv              1.6.15  2024-03-26 [1] CRAN (R 4.3.1)\n httr                1.4.7   2023-08-15 [1] CRAN (R 4.3.0)\n jsonlite            1.8.8   2023-12-04 [1] CRAN (R 4.3.1)\n knitr               1.48    2024-07-07 [1] CRAN (R 4.3.3)\n later               1.3.2   2023-12-06 [1] CRAN (R 4.3.1)\n lifecycle           1.0.4   2023-11-07 [1] CRAN (R 4.3.1)\n lubridate         * 1.9.3   2023-09-27 [1] CRAN (R 4.3.1)\n magrittr            2.0.3   2022-03-30 [1] CRAN (R 4.3.0)\n mime                0.12    2021-09-28 [1] CRAN (R 4.3.0)\n munsell             0.5.1   2024-04-01 [1] CRAN (R 4.3.1)\n officer             0.6.6   2024-05-05 [1] CRAN (R 4.3.1)\n openssl             2.2.1   2024-08-16 [1] CRAN (R 4.3.3)\n pacman              0.5.1   2019-03-11 [1] CRAN (R 4.3.0)\n pillar              1.9.0   2023-03-22 [1] CRAN (R 4.3.0)\n pkgconfig           2.0.3   2019-09-22 [1] CRAN (R 4.3.0)\n promises            1.3.0   2024-04-05 [1] CRAN (R 4.3.1)\n purrr             * 1.0.2   2023-08-10 [1] CRAN (R 4.3.0)\n R.methodsS3         1.8.2   2022-06-13 [1] CRAN (R 4.3.0)\n R.oo                1.26.0  2024-01-24 [1] CRAN (R 4.3.1)\n R.utils             2.12.3  2023-11-18 [1] CRAN (R 4.3.1)\n R6                  2.5.1   2021-08-19 [1] CRAN (R 4.3.0)\n ragg                1.3.2   2024-05-15 [1] CRAN (R 4.3.3)\n Rcpp                1.0.13  2024-07-17 [1] CRAN (R 4.3.3)\n reactable           0.4.4   2023-03-12 [1] CRAN (R 4.3.0)\n reactR              0.5.0   2023-10-11 [1] CRAN (R 4.3.1)\n readr             * 2.1.5   2024-01-10 [1] CRAN (R 4.3.1)\n rio                 1.2.2   2024-08-19 [1] CRAN (R 4.3.3)\n rlang               1.1.4   2024-06-04 [1] CRAN (R 4.3.3)\n rmarkdown           2.28    2024-08-17 [1] CRAN (R 4.3.3)\n rprojroot           2.0.4   2023-11-05 [1] CRAN (R 4.3.1)\n rstudioapi          0.16.0  2024-03-24 [1] CRAN (R 4.3.1)\n rvest             * 1.0.4   2024-02-12 [1] CRAN (R 4.3.1)\n scales              1.3.0   2023-11-28 [1] CRAN (R 4.3.1)\n sessioninfo         1.2.2   2021-12-06 [1] CRAN (R 4.3.0)\n shiny               1.9.1   2024-08-01 [1] CRAN (R 4.3.3)\n stringi             1.8.4   2024-05-06 [1] CRAN (R 4.3.1)\n stringr           * 1.5.1   2023-11-14 [1] CRAN (R 4.3.1)\n systemfonts         1.1.0   2024-05-15 [1] CRAN (R 4.3.3)\n textshaping         0.4.0   2024-05-24 [1] CRAN (R 4.3.3)\n tibble            * 3.2.1   2023-03-20 [1] CRAN (R 4.3.0)\n tidyr             * 1.3.1   2024-01-24 [1] CRAN (R 4.3.1)\n tidyselect          1.2.1   2024-03-11 [1] CRAN (R 4.3.1)\n tidyverse         * 2.0.0   2023-02-22 [1] CRAN (R 4.3.0)\n timechange          0.3.0   2024-01-18 [1] CRAN (R 4.3.1)\n tzdb                0.4.0   2023-05-12 [1] CRAN (R 4.3.0)\n utf8                1.2.4   2023-10-22 [1] CRAN (R 4.3.1)\n uuid                1.2-1   2024-07-29 [1] CRAN (R 4.3.3)\n vctrs               0.6.5   2023-12-01 [1] CRAN (R 4.3.1)\n withr               3.0.1   2024-07-31 [1] CRAN (R 4.3.3)\n xfun                0.47    2024-08-17 [1] CRAN (R 4.3.3)\n xml2                1.3.6   2023-12-04 [1] CRAN (R 4.3.1)\n xtable              1.8-4   2019-04-21 [1] CRAN (R 4.3.0)\n yaml                2.3.10  2024-07-26 [1] CRAN (R 4.3.3)\n zip                 2.3.1   2024-01-27 [1] CRAN (R 4.3.1)\n\n [1] /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/core-js-2.5.3/shim.min.js\"></script>\n<script src=\"../../site_libs/react-18.2.0/react.min.js\"></script>\n<script src=\"../../site_libs/react-18.2.0/react-dom.min.js\"></script>\n<script src=\"../../site_libs/reactwidget-1.0.0/react-tools.js\"></script>\n<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../../site_libs/reactable-0.4.4/reactable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/reactable-binding-0.4.4/reactable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}